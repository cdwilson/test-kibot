kibot:
  version: 1

global:
  out_dir: exports
  drc_exclusions_workaround: true
  restore_project: true
  filters:
    # KiBot docker image warnings
    - number: 9
      regex: "KiCad config without environment.vars section"
    - number: 10
      regex: "Unable to find KiCad 3D models"
    - number: 58
      regex: Missing KiCad main config file
    # project-specific warnings
    - number: 20
      regex: "(no match in C3)"

preflight:
  # [boolean=false] Zones are filled before doing any operation involving PCB layers.
  # The original PCB remains unchanged.
  check_zone_fills: true
  # [boolean=false] Option for `run_erc`. ERC warnings are considered errors.
  erc_warnings: false
  # [boolean=false] Fill all zones again and save the PCB.
  fill_zones: true
  # [list(dict)] A list of entries to filter out ERC/DRC messages.
  ignore_unconnected: false
  # [boolean=false] Runs the DRC (Distance Rules Check). To ensure we have a valid PCB.
  # The report file name is controlled by the global output pattern (%i=drc %x=txt).
  run_drc: true
  # [boolean=false] Runs the ERC (Electrical Rules Check). To ensure the schematic is electrically correct.
  # The report file name is controlled by the global output pattern (%i=erc %x=txt).
  run_erc: true
  # [boolean=false] Update the XML version of the BoM (Bill of Materials).
  # To ensure our generated BoM is up to date.
  # Note that this isn't needed when using the internal BoM generator (`bom`).
  update_xml: true

outputs:
  - name: bom_html_no_dnf_filter
    comment: Export the BOM to HTML
    type: bom
    dir: BOM
    options:
      format: HTML
      fit_field: BOM
      ignore_dnf: true
      output: "bom_no_dnf_filter.%x"
  - name: bom_html_with_dnf_filter
    comment: Export the BOM to HTML
    type: bom
    dir: BOM
    options:
      format: HTML
      fit_field: BOM
      ignore_dnf: true
      dnf_filter: _kibom_dnf_BOM
      output: "bom_with_dnf_filter.%x"
  - name: kibom_html_no_dnf_filter
    comment: Export the BOM to HTML
    type: kibom
    dir: BOM
    options:
      format: HTML
      conf:
        fit_field: BOM
        ignore_dnf: true
      output: "kibom_no_dnf_filter.%x"
  - name: user_drawings_gerber_x2
    comment: Export user drawings in the Gerber X2 format
    type: gerber
    dir: Gerber
    layers:
      - Dwgs.User
    options:
      create_gerber_job_file: false
      plot_sheet_reference: true
      dnf_filter: _kibom_dnf_BOM
      subtract_mask_from_silk: true
      use_aux_axis_as_origin: true
      output: "%f_%i.%x"
